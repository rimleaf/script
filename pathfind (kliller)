--// Services
local Players = game:GetService("Players")
local PathfindingService = game:GetService("PathfindingService")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

--// Vars
local hum = LocalPlayer.Character:WaitForChild("Humanoid")
local root = LocalPlayer.Character:WaitForChild("HumanoidRootPart")
local followEnabled = false
local targetPlayer = nil
local path = PathfindingService:CreatePath({
	AgentRadius = 2,
	AgentHeight = 5,
	AgentCanJump = true,
	AgentCanClimb = true
})

--// UI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "PathFollowGui"
screenGui.ResetOnSpawn = false -- âœ… GUI stays after respawn
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 120, 0, 40)
button.Position = UDim2.new(0, 20, 0, 200)
button.Text = "Follow"
button.Parent = screenGui

--// Functions
local function getRoot(character)
	if character then
		return character:FindFirstChild("HumanoidRootPart")
	end
	return nil
end

local function followTarget()
	while followEnabled and targetPlayer and targetPlayer.Character do
		local targetRoot = getRoot(targetPlayer.Character)
		if targetRoot then
			path:ComputeAsync(root.Position, targetRoot.Position)
			if path.Status == Enum.PathStatus.Complete then
				for _, waypoint in ipairs(path:GetWaypoints()) do
					if not followEnabled then break end
					hum:MoveTo(waypoint.Position)
					hum.MoveToFinished:Wait()
				end
			else
				-- fallback: walk directly if path fails
				hum:MoveTo(targetRoot.Position)
			end
		end
		task.wait() -- recheck path every half second
	end
end

--// Button logic
button.MouseButton1Click:Connect(function()
	if not followEnabled then
		-- Pick the first player in the server other than yourself
		for _, plr in ipairs(Players:GetPlayers()) do
			if plr ~= LocalPlayer then
				targetPlayer = plr
				break
			end
		end
		if targetPlayer then
			followEnabled = true
			button.Text = "Stop Following"
			task.spawn(followTarget)
		else
			button.Text = "No Players"
		end
	else
		followEnabled = false
		button.Text = "Follow"
	end
end)

-- Respawn safety
LocalPlayer.CharacterAdded:Connect(function(char)
	hum = char:WaitForChild("Humanoid")
	root = char:WaitForChild("HumanoidRootPart")
end)
