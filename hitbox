local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Rep = game:GetService("ReplicatedStorage")

local client = Players.LocalPlayer

repeat task.wait() until client and client.Character

local char = client.Character
local humanoid = char:WaitForChild("Humanoid")
local root = char:WaitForChild("HumanoidRootPart")

client.CharacterAdded:Connect(function(newChar)
	char = newChar
	humanoid = char:WaitForChild("Humanoid")
	root = char:WaitForChild("HumanoidRootPart")
end)

-- Original Extend function (untouched)
local function ExtendHitbox(studs)
	RunService.Heartbeat:Wait()

	while not (
		client.Character
		and client.Character.Parent
		and client.Character:FindFirstChild("HumanoidRootPart")
		and client.Character.HumanoidRootPart.Parent
	) do
		RunService.Heartbeat:Wait()
	end

	local hrp = client.Character.HumanoidRootPart
	local originalVel = hrp.AssemblyLinearVelocity
	local look = hrp.CFrame.LookVector

	hrp.AssemblyLinearVelocity += look * studs
	RunService.RenderStepped:Wait()

	if client.Character
	and client.Character.Parent
	and client.Character:FindFirstChild("HumanoidRootPart")
	and client.Character.HumanoidRootPart.Parent then
		client.Character.HumanoidRootPart.AssemblyLinearVelocity = originalVel
	end
end

-- Remote reference
local Remote = Rep:WaitForChild("Modules"):WaitForChild("Network"):WaitForChild("RemoteEvent")

local function getAbilityName(v)
	if typeof(v) == "buffer" then
		return buffer.tostring(v)
	end
	return v
end

local canExtend = true
local cooldown = 2

local function cleanName(name)
    return tostring(name):gsub("\"", "")
end

Remote.OnClientEvent:Connect(function(action, data)
    if action ~= "UseActorAbility" then return end
    if typeof(data) ~= "table" or not data[1] then return end

    local abilityName = cleanName(getAbilityName(data[1]))

    if (abilityName == "Carving Slash" or
        abilityName == "Slash" or
        abilityName == "Stab" or
        abilityName == "Punch") then

        local start = os.clock()
        local conn
        conn = RunService.Heartbeat:Connect(function()
            if os.clock() - start >= 1.5 then
                conn:Disconnect()
                return
            end
            ExtendHitbox(35)
        end)
    end
end)
